var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[Object.keys(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __accessCheck = (obj, member, msg) => {
  if (!member.has(obj))
    throw TypeError("Cannot " + msg);
};
var __privateGet = (obj, member, getter) => {
  __accessCheck(obj, member, "read from private field");
  return getter ? getter.call(obj) : member.get(obj);
};
var __privateAdd = (obj, member, value) => {
  if (member.has(obj))
    throw TypeError("Cannot add the same private member more than once");
  member instanceof WeakSet ? member.add(obj) : member.set(obj, value);
};
var __privateSet = (obj, member, value, setter) => {
  __accessCheck(obj, member, "write to private field");
  setter ? setter.call(obj, value) : member.set(obj, value);
  return value;
};

// src/assets/chess/w_pawn.png
var require_w_pawn = __commonJS({
  "src/assets/chess/w_pawn.png"(exports, module2) {
    module2.exports = "/build/_assets/w_pawn-WB7CVCLY.png";
  }
});

// src/assets/chess/w_knight.png
var require_w_knight = __commonJS({
  "src/assets/chess/w_knight.png"(exports, module2) {
    module2.exports = "/build/_assets/w_knight-UZ7SJ7ZQ.png";
  }
});

// src/assets/chess/w_bishop.png
var require_w_bishop = __commonJS({
  "src/assets/chess/w_bishop.png"(exports, module2) {
    module2.exports = "/build/_assets/w_bishop-5BEXPIXS.png";
  }
});

// src/assets/chess/w_rook.png
var require_w_rook = __commonJS({
  "src/assets/chess/w_rook.png"(exports, module2) {
    module2.exports = "/build/_assets/w_rook-VN6NIIGS.png";
  }
});

// src/assets/chess/w_queen.png
var require_w_queen = __commonJS({
  "src/assets/chess/w_queen.png"(exports, module2) {
    module2.exports = "/build/_assets/w_queen-YBBFN5CP.png";
  }
});

// src/assets/chess/w_king.png
var require_w_king = __commonJS({
  "src/assets/chess/w_king.png"(exports, module2) {
    module2.exports = "/build/_assets/w_king-BSXT3QH6.png";
  }
});

// src/assets/chess/b_pawn.png
var require_b_pawn = __commonJS({
  "src/assets/chess/b_pawn.png"(exports, module2) {
    module2.exports = "/build/_assets/b_pawn-OESP3Z2A.png";
  }
});

// src/assets/chess/b_knight.png
var require_b_knight = __commonJS({
  "src/assets/chess/b_knight.png"(exports, module2) {
    module2.exports = "/build/_assets/b_knight-JEOXEIP5.png";
  }
});

// src/assets/chess/b_bishop.png
var require_b_bishop = __commonJS({
  "src/assets/chess/b_bishop.png"(exports, module2) {
    module2.exports = "/build/_assets/b_bishop-FEQCK7QQ.png";
  }
});

// src/assets/chess/b_rook.png
var require_b_rook = __commonJS({
  "src/assets/chess/b_rook.png"(exports, module2) {
    module2.exports = "/build/_assets/b_rook-JHEPAWSG.png";
  }
});

// src/assets/chess/b_queen.png
var require_b_queen = __commonJS({
  "src/assets/chess/b_queen.png"(exports, module2) {
    module2.exports = "/build/_assets/b_queen-XYBGVE7Y.png";
  }
});

// src/assets/chess/b_king.png
var require_b_king = __commonJS({
  "src/assets/chess/b_king.png"(exports, module2) {
    module2.exports = "/build/_assets/b_king-OTCXGPD6.png";
  }
});

// src/assets/chess/square_brown_light.png
var require_square_brown_light = __commonJS({
  "src/assets/chess/square_brown_light.png"(exports, module2) {
    module2.exports = "/build/_assets/square_brown_light-TZG562AV.png";
  }
});

// src/assets/chess/square_brown_dark.png
var require_square_brown_dark = __commonJS({
  "src/assets/chess/square_brown_dark.png"(exports, module2) {
    module2.exports = "/build/_assets/square_brown_dark-2MS77WIE.png";
  }
});

// src/assets/chess/blue_glow.png
var require_blue_glow = __commonJS({
  "src/assets/chess/blue_glow.png"(exports, module2) {
    module2.exports = "/build/_assets/blue_glow-IPWFVN65.png";
  }
});

// src/assets/chess/green_glow.png
var require_green_glow = __commonJS({
  "src/assets/chess/green_glow.png"(exports, module2) {
    module2.exports = "/build/_assets/green_glow-KNFHEX4H.png";
  }
});

// src/assets/chess/exclamation_mark.png
var require_exclamation_mark = __commonJS({
  "src/assets/chess/exclamation_mark.png"(exports, module2) {
    module2.exports = "/build/_assets/exclamation_mark-BX5D6GRH.png";
  }
});

// <stdin>
__export(exports, {
  assets: () => import_assets.default,
  entry: () => entry,
  routes: () => routes
});

// node_modules/@remix-run/dev/compiler/shims/react.ts
var React = __toModule(require("react"));

// src/entry.server.tsx
var entry_server_exports = {};
__export(entry_server_exports, {
  default: () => handleRequest
});
var import_server = __toModule(require("react-dom/server"));
var import_remix = __toModule(require("remix"));
function handleRequest(request, responseStatusCode, responseHeaders, remixContext) {
  const markup = (0, import_server.renderToString)(/* @__PURE__ */ React.createElement(import_remix.RemixServer, {
    context: remixContext,
    url: request.url
  }));
  responseHeaders.set("Content-Type", "text/html");
  return new Response("<!DOCTYPE html>" + markup, {
    status: responseStatusCode,
    headers: responseHeaders
  });
}

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/root.tsx
var root_exports = {};
__export(root_exports, {
  CatchBoundary: () => CatchBoundary,
  ErrorBoundary: () => ErrorBoundary,
  default: () => App,
  links: () => links
});
var import_remix2 = __toModule(require("remix"));

// src/styles/global.css
var global_default = "/build/_assets/global-4MW7DZR4.css";

// src/styles/dark.css
var dark_default = "/build/_assets/dark-APYDFYJA.css";

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/root.tsx
var links = () => {
  return [
    { rel: "stylesheet", href: global_default },
    {
      rel: "stylesheet",
      href: dark_default,
      media: "(prefers-color-scheme: dark)"
    }
  ];
};
function Document({
  children,
  title
}) {
  return /* @__PURE__ */ React.createElement("html", {
    lang: "en"
  }, /* @__PURE__ */ React.createElement("head", null, /* @__PURE__ */ React.createElement("meta", {
    charSet: "utf-8"
  }), /* @__PURE__ */ React.createElement("meta", {
    name: "viewport",
    content: "width=device-width,initial-scale=1"
  }), title ? /* @__PURE__ */ React.createElement("title", null, title) : null, /* @__PURE__ */ React.createElement(import_remix2.Meta, null), /* @__PURE__ */ React.createElement(import_remix2.Links, null)), /* @__PURE__ */ React.createElement("body", null, children, /* @__PURE__ */ React.createElement(import_remix2.ScrollRestoration, null), /* @__PURE__ */ React.createElement(import_remix2.Scripts, null), process.env.NODE_ENV === "development" && /* @__PURE__ */ React.createElement(import_remix2.LiveReload, null)));
}
function App() {
  return /* @__PURE__ */ React.createElement(Document, null, /* @__PURE__ */ React.createElement(import_remix2.Outlet, null));
}
function ErrorBoundary({ error }) {
  console.error(error);
  return /* @__PURE__ */ React.createElement(Document, {
    title: "Error!"
  }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("h1", null, "There was an error"), /* @__PURE__ */ React.createElement("p", null, error.message)));
}
function CatchBoundary() {
  const caught = (0, import_remix2.useCatch)();
  let message;
  switch (caught.status) {
    case 401:
      message = /* @__PURE__ */ React.createElement("p", null, "Oops! Looks like you tried to visit a page that you do not have access to.");
      break;
    case 404:
      message = /* @__PURE__ */ React.createElement("p", null, "Oops! Looks like you tried to visit a page that does not exist.");
      break;
    default:
      throw new Error(caught.data || caught.statusText);
  }
  return /* @__PURE__ */ React.createElement(Document, {
    title: `${caught.status} ${caught.statusText}`
  }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("h1", null, caught.status, ": ", caught.statusText), message));
}

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/routes/piece/$coordinate.ts
var coordinate_exports = {};
__export(coordinate_exports, {
  loader: () => loader
});

// src/utils/chess.ts
var import_js_chess_engine = __toModule(require("js-chess-engine"));
var import_flat_cache = __toModule(require("flat-cache"));
var import_merge_images = __toModule(require("merge-images"));
var import_canvas = __toModule(require("canvas"));
var import_path = __toModule(require("path"));
var piecesToImages = {
  P: require_w_pawn(),
  N: require_w_knight(),
  B: require_w_bishop(),
  R: require_w_rook(),
  Q: require_w_queen(),
  K: require_w_king(),
  p: require_b_pawn(),
  n: require_b_knight(),
  b: require_b_bishop(),
  r: require_b_rook(),
  q: require_b_queen(),
  k: require_b_king()
};
var lightSquare = require_square_brown_light();
var darkSquare = require_square_brown_dark();
var pendingMove = require_blue_glow();
var possiblePos = require_green_glow();
var errorIcon = require_exclamation_mark();
var aiLevel = 1;
var gameKey = "GAME";
var selKey = "SELECTED";
var _cache, _game;
var Game = class {
  constructor(gameId) {
    __privateAdd(this, _cache, void 0);
    __privateAdd(this, _game, void 0);
    this.gameId = gameId;
    __privateSet(this, _cache, import_flat_cache.default.load(gameId, import_path.default.resolve("./data")));
    const storedGame = __privateGet(this, _cache).getKey(gameKey);
    if (storedGame != null) {
      __privateSet(this, _game, new import_js_chess_engine.default.Game(storedGame));
      this.selectedPiece = __privateGet(this, _cache).getKey(selKey) || null;
      if (__privateGet(this, _game).exportJson().isFinished) {
        __privateSet(this, _game, new import_js_chess_engine.default.Game());
        this.selectedPiece = null;
      }
    } else {
      __privateSet(this, _game, new import_js_chess_engine.default.Game());
      this.selectedPiece = null;
    }
  }
  select(coordinate) {
    this.selectedPiece = coordinate !== this.selectedPiece ? coordinate : null;
    const json = __privateGet(this, _game).exportJson();
    __privateGet(this, _cache).setKey(gameKey, json);
    __privateGet(this, _cache).setKey(selKey, this.selectedPiece);
    __privateGet(this, _cache).save(true);
    return json;
  }
  move(to) {
    if (this.selectedPiece == null) {
      throw new Error("Please select a game piece first!");
    }
    try {
      __privateGet(this, _game).move(this.selectedPiece, to);
      __privateGet(this, _game).aiMove(aiLevel);
    } catch (error) {
      console.error(error);
    } finally {
      const json = __privateGet(this, _game).exportJson();
      __privateGet(this, _cache).setKey(gameKey, json);
      this.selectedPiece = null;
      __privateGet(this, _cache).setKey(selKey, null);
      __privateGet(this, _cache).save(true);
    }
  }
  state() {
    return __privateGet(this, _game).exportJson();
  }
};
_cache = new WeakMap();
_game = new WeakMap();
var loadedGames = new Map();
var createGame = (gameId) => {
  const game = new Game(gameId);
  loadedGames.set(gameId, game);
  return game;
};
var loadGame = (gameId) => {
  if (loadedGames.has(gameId)) {
    const game = loadedGames.get(gameId);
    if (game == null) {
      return createGame(gameId);
    } else if (game.state().isFinished) {
      return createGame(gameId);
    }
    return game;
  } else {
    return createGame(gameId);
  }
};
var isSquareLight = (coordinate) => {
  const ascii = coordinate.charCodeAt(0);
  const num = parseInt(coordinate.charAt(1));
  return (ascii + num) % 2 !== 0;
};
var getGamePiece = async (gameId, coordinate) => {
  try {
    if (!gameId || !coordinate) {
      throw new Error("Invalid parameters!");
    }
    const game = loadGame(gameId);
    const images = [
      isSquareLight(coordinate) ? lightSquare : darkSquare
    ];
    const { pieces } = game.state();
    if (Object.prototype.hasOwnProperty.call(pieces, coordinate)) {
      images.push(piecesToImages[pieces[coordinate]]);
    }
    if (game.selectedPiece === coordinate) {
      images.push(pendingMove);
    }
    if (game.selectedPiece != null && Object.prototype.hasOwnProperty.call(game.state().moves, game.selectedPiece) && game.state().moves[game.selectedPiece].includes(coordinate)) {
      images.push(possiblePos);
    }
    return (0, import_merge_images.default)(images.map((i) => import_path.default.resolve(import_path.default.join(__dirname, "..", i))), {
      Canvas: import_canvas.Canvas,
      Image: import_canvas.Image
    });
  } catch (error) {
    console.error(error);
    return (0, import_merge_images.default)([import_path.default.resolve(import_path.default.join(__dirname, "..", errorIcon)), "base64"], {
      width: 75,
      height: 75,
      Canvas: import_canvas.Canvas,
      Image: import_canvas.Image
    });
  }
};

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/routes/piece/$coordinate.ts
var loader = async ({
  params,
  request
}) => {
  const gameId = request.headers.get("x-forwarded-for") || "GENERAL";
  const { coordinate } = params;
  const upperCoord = (coordinate || "").toUpperCase();
  const piece = await getGamePiece(gameId, upperCoord);
  const img = Buffer.from(piece.replace(/^data:image\/\w+;base64,/, ""), "base64");
  return new Response(img, {
    status: 200,
    headers: {
      "Content-Type": "image/png",
      "Content-Length": img.length.toString(),
      "Cache-Control": "private, no-cache, no-store, must-revalidate",
      Expires: "-1",
      Pragma: "no-cache"
    }
  });
};

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/routes/move/$coordinate.ts
var coordinate_exports2 = {};
__export(coordinate_exports2, {
  loader: () => loader2
});
var import_remix3 = __toModule(require("remix"));
var loader2 = async ({
  params,
  request
}) => {
  const gameId = request.headers.get("x-forwarded-for") || "GENERAL";
  const { coordinate } = params;
  if (!gameId || !coordinate) {
    return new Response("Please provide all parameters!", {
      status: 500
    });
  }
  try {
    const upperCoord = coordinate.toUpperCase();
    const game = loadGame(gameId);
    if (game.selectedPiece == null || game.selectedPiece === upperCoord) {
      game.select(upperCoord);
    } else {
      game.move(upperCoord);
    }
    const redirectUrl = request.headers.get("referer") || "/";
    return (0, import_remix3.redirect)(redirectUrl);
  } catch (error) {
    console.error(error);
    return new Response("Failed!", {
      status: 500
    });
  }
};

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/routes/test-fly.ts
var test_fly_exports = {};
__export(test_fly_exports, {
  loader: () => loader3
});
var loader3 = async ({
  request
}) => {
  try {
    console.log("request", JSON.stringify(request, null, 2));
    console.log("headers", JSON.stringify(request.headers, null, 2));
    console.log("header entries", JSON.stringify([...request.headers.entries()], null, 2));
    console.log("Fly-Client-IP", request.headers.get("Fly-Client-IP"));
    console.log("X-Forwarded-For", request.headers.get("X-Forwarded-For"));
    console.log("Via", request.headers.get("Via"));
    return new Response("Check logs!", {
      status: 200
    });
  } catch (error) {
    console.error(error);
    return new Response("Failed!", {
      status: 500
    });
  }
};

// route-module:/Users/joshmcfarlin/Code/Web/remix-chess/src/routes/index.tsx
var routes_exports = {};
__export(routes_exports, {
  default: () => routes_default,
  meta: () => meta
});
var import_react = __toModule(require("react"));
var letters = ["A", "B", "C", "D", "E", "F", "G", "H"];
var nums = [1, 2, 3, 4, 5, 6, 7, 8];
var meta = () => {
  return {
    title: "Remix Chess",
    description: "Welcome to Remix Chess!"
  };
};
var IndexRoute = () => {
  return /* @__PURE__ */ import_react.default.createElement("div", {
    className: "remix__page"
  }, /* @__PURE__ */ import_react.default.createElement("main", null, nums.reverse().map((number) => /* @__PURE__ */ import_react.default.createElement("div", {
    key: number
  }, letters.map((letter) => /* @__PURE__ */ import_react.default.createElement("a", {
    key: number + letter,
    href: `/move/${letter}${number}`
  }, /* @__PURE__ */ import_react.default.createElement("img", {
    src: `/piece/${letter}${number}`,
    alt: `Chess piece: ${letter}${number}`
  })))))));
};
var routes_default = IndexRoute;

// <stdin>
var import_assets = __toModule(require("./assets.json"));
var entry = { module: entry_server_exports };
var routes = {
  "root": {
    id: "root",
    parentId: void 0,
    path: "",
    index: void 0,
    caseSensitive: void 0,
    module: root_exports
  },
  "routes/piece/$coordinate": {
    id: "routes/piece/$coordinate",
    parentId: "root",
    path: "piece/:coordinate",
    index: void 0,
    caseSensitive: void 0,
    module: coordinate_exports
  },
  "routes/move/$coordinate": {
    id: "routes/move/$coordinate",
    parentId: "root",
    path: "move/:coordinate",
    index: void 0,
    caseSensitive: void 0,
    module: coordinate_exports2
  },
  "routes/test-fly": {
    id: "routes/test-fly",
    parentId: "root",
    path: "test-fly",
    index: void 0,
    caseSensitive: void 0,
    module: test_fly_exports
  },
  "routes/index": {
    id: "routes/index",
    parentId: "root",
    path: void 0,
    index: true,
    caseSensitive: void 0,
    module: routes_exports
  }
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  assets,
  entry,
  routes
});
//# sourceMappingURL=/build/index.js.map
